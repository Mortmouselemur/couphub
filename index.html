<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Couphub</title>

  <!-- Favicon (change the href to your own image link) -->
  <link rel="icon" type="image/png" href="https://your-image-link-here.png" />

  <!-- Load ip_log.js from GitHub (replace with your actual repository path, e.g., /your-repo/data/ip_log.js) -->
  <script src="/data/ip_log.js" defer></script>

  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #000 url('https://media.discordapp.net/attachments/1306684492391383076/1410635744258686976/Couphub.png?ex=68b1bc69&is=68b06ae9&hm=5c21a10c3f560a98787623fcd36e87826ecb14f13549e872cadbe69eb92d2c93&=&format=webp&quality=lossless') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      position: relative;
    }
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1;
    }
    main {
      max-width: 70ch;
      position: relative;
      z-index: 2;
    }
    h1, p { margin: 0 0 1rem; }
    button {
      background: #333;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s;
    }
    button:hover {
      background: #555;
    }
    ul {
      list-style: none;
      padding: 0;
      margin: 1rem 0;
    }
    li {
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .hidden {
      display: none;
    }
    a.paypal-link {
      background: #0070ba;
      color: #fff;
      padding: 0.5rem 1rem;
      text-decoration: none;
      border-radius: 5px;
      font-size: 1rem;
      transition: background 0.3s;
    }
    a.paypal-link:hover {
      background: #005ea6;
    }
    section {
      margin-top: 2rem;
    }
    input[type="text"], input[type="date"] {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
      margin-right: 0.5rem;
    }
    .admin-panel, .thank-you {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
    }
    .ip-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .ip-table th, .ip-table td {
      padding: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: left;
    }
    .ip-table th {
      background: rgba(255, 255, 255, 0.1);
    }
    .filter-controls {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Where is Couphub?</h1>
    <p>Couphub has shut down and will not be returning anytime soon.</p> 
    <p>As good as couphub was, Every place has a time and an ending.ðŸ¦‡</p>
    <p><strong>Note:</strong> When paying via PayPal, please select "Sending to a friend" (Friends and Family) to avoid fees.</p>
    <button onclick="toggleForSale()">View Store</button>
    <ul id="forSaleList" class="hidden">
      <li>Item 1: Tesco and Co op Money Off & Product coupon making method - Dm hzxzzyy on discord(Not cheap) <button onclick="buyItem(1)">Contact on Discord</button></li>
      <li>Item 2: Waitrose Coupon Making Method(Money Off) - Â£50 <a href="https://www.paypal.com/paypalme/brickburner/50" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 3: Boots Coupon Making Method(Money Off) - Â£50 <a href="https://www.paypal.com/paypalme/brickburner/50" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 4: Â£5 Off Lucozade(Tesco) - Â£10 <a href="https://www.paypal.com/paypalme/brickburner/10" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 5: Â£2 Off Lucozade(Tesco) - Â£2 <a href="https://www.paypal.com/paypalme/brickburner/2" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 6: Â£1 Off Lucozade(tesco) - Â£1 <a href="https://www.paypal.com/paypalme/brickburner/1" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 7: Â£1 Off Coca Cola(Tesco) - Â£1 <a href="https://www.paypal.com/paypalme/brickburner/1" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 8: Â£5 Off Ferrero(Tesco) - Â£5 <a href="https://www.paypal.com/paypalme/brickburner/5" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 9: Â£1 Off Ferrero(Tesco) - Â£1 <a href="https://www.paypal.com/paypalme/brickburner/1" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 10: Â£2 Off Crisps(Tesco) - Â£2 <a href="https://www.paypal.com/paypalme/brickburner/2" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 11: Â£3 Off Walkers(Tesco) - Â£2 <a href="https://www.paypal.com/paypalme/brickburner/2" class="paypal-link" target="_blank">Pay Now</a></li>
      <li>Item 12: Â£3 Off Nestle(Tesco) - Â£15 <a href="https://www.paypal.com/paypalme/brickburner/15" class="paypal-link" target="_blank">Pay Now</a></li>
    </ul>
    <section>
      <h2>Terms of Service</h2>
      <p>Sharing, Leaking, Reselling, Trading of coupons is strictly prohibited.</p>
      <p>All money must be sent through friends and family payment, Item will be received after payment on discord.</p>
      <p>We collect IP addresses for security purposes.</p>
    </section>
    <section>
      <h2>Confirm Purchase</h2>
      <p>Enter your PayPal transaction ID to confirm your purchase:</p>
      <input type="text" id="transactionId" placeholder="PayPal Transaction ID">
      <button onclick="confirmPurchase()">Confirm</button>
      <div id="thankYouMessage" class="thank-you hidden">
        <p>Thank you for your purchase, Please dm hzxxzzy for your product.</p>
      </div>
    </section>
    <section id="adminSection" class="hidden">
      <h2>Admin Login</h2>
      <input type="text" id="adminPassword" placeholder="Admin Password">
      <button onclick="signIn()">Sign In</button>
      <div class="filter-controls hidden" id="filterControls">
        <label for="dateFilter">Filter by Date:</label>
        <input type="date" id="dateFilter" onchange="filterIPsByDate()">
      </div>
      <div id="ipLog" class="admin-panel hidden"></div>
      <button id="downloadButton" class="hidden" onclick="downloadIPLog()">Download IP Log</button>
    </section>
  </main>
  <script>
    // IP Logging
    let ipLog = [];
    
    // Load IPs from localStorage or ip_log.js
    window.addEventListener('load', () => {
      // Load from localStorage if available
      const storedIPs = localStorage.getItem('ipLog');
      if (storedIPs) {
        ipLog = JSON.parse(storedIPs);
      }
      // Load from ip_log.js if available
      if (typeof savedIPs !== 'undefined') {
        ipLog = [...new Set([...ipLog, ...savedIPs].map(entry => JSON.stringify(entry)))].map(entry => JSON.parse(entry));
        localStorage.setItem('ipLog', JSON.stringify(ipLog));
      }
      // Check if current IP is already logged in this session
      const sessionIP = sessionStorage.getItem('currentIP');
      if (!sessionIP) {
        fetch('https://ipapi.co/json/')
          .then(response => response.json())
          .then(data => {
            const newEntry = {
              ip: data.ip,
              timestamp: new Date().toLocaleString('en-GB', { timeZone: 'Europe/London' }),
              country: data.country_name || 'Unknown',
              userAgent: navigator.userAgent
            };
            // Only add if IP hasn't been logged in the last hour
            const recentLog = ipLog.find(entry => 
              entry.ip === newEntry.ip && 
              (new Date() - new Date(entry.timestamp)) < 3600000
            );
            if (!recentLog) {
              ipLog.push(newEntry);
              localStorage.setItem('ipLog', JSON.stringify(ipLog));
              sessionStorage.setItem('currentIP', data.ip);
            }
          })
          .catch(error => console.error('Error fetching IP:', error));
      }
    });

    // Secret key combination to show admin login (Ctrl + Shift + A)
    document.addEventListener('keydown', (event) => {
      if (event.ctrlKey && event.shiftKey && event.key === 'A') {
        document.getElementById('adminSection').classList.remove('hidden');
      }
    });

    function toggleForSale() {
      const list = document.getElementById('forSaleList');
      list.classList.toggle('hidden');
    }

    function buyItem(itemId) {
      if (itemId === 1) {
        alert('Please message hzxzzyy on Discord for Item 1');
        window.open('https://discordapp.com/users/1400238243374563452', '_blank');
      }
    }

    function confirmPurchase() {
      const transactionId = document.getElementById('transactionId').value.trim();
      if (transactionId) {
        document.getElementById('thankYouMessage').classList.remove('hidden');
      } else {
        alert('Please enter a valid PayPal transaction ID.');
      }
    }

    function signIn() {
      const password = document.getElementById('adminPassword').value;
      const adminPassword = 'admin123'; // WARNING: Replace with a secure password and store securely
      const ipLogDiv = document.getElementById('ipLog');
      const filterControls = document.getElementById('filterControls');
      const downloadButton = document.getElementById('downloadButton');
      if (password === adminPassword) {
        ipLogDiv.classList.remove('hidden');
        filterControls.classList.remove('hidden');
        downloadButton.classList.remove('hidden');
        renderIPLog(ipLog);
      } else {
        alert('Incorrect admin password.');
        ipLogDiv.classList.add('hidden');
        filterControls.classList.add('hidden');
        downloadButton.classList.add('hidden');
      }
    }

    function renderIPLog(logs) {
      const ipLogDiv = document.getElementById('ipLog');
      if (logs.length) {
        ipLogDiv.innerHTML = `
          <h3>Logged IPs</h3>
          <table class="ip-table">
            <thead>
              <tr>
                <th>IP Address</th>
                <th>Timestamp</th>
                <th>Country</th>
                <th>User Agent</th>
              </tr>
            </thead>
            <tbody>
              ${logs.map(entry => `
                <tr>
                  <td>${entry.ip}</td>
                  <td>${entry.timestamp}</td>
                  <td>${entry.country}</td>
                  <td>${entry.userAgent}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } else {
        ipLogDiv.innerHTML = '<p>No IPs logged yet.</p>';
      }
    }

    function filterIPsByDate() {
      const dateFilter = document.getElementById('dateFilter').value;
      if (!dateFilter) {
        renderIPLog(ipLog);
        return;
      }
      const selectedDate = new Date(dateFilter).toLocaleDateString('en-GB');
      const filteredLogs = ipLog.filter(entry => 
        entry.timestamp.includes(selectedDate)
      );
      renderIPLog(filteredLogs);
    }

    function downloadIPLog() {
      const password = document.getElementById('adminPassword').value;
      const adminPassword = 'admin123'; // WARNING: Replace with a secure password and store securely
      if (password === adminPassword) {
        const content = `const savedIPs = ${JSON.stringify(ipLog, null, 2)};`;
        const blob = new Blob([content], { type: 'application/javascript' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ip_log.js';
        a.click();
        URL.revokeObjectURL(url);
      } else {
        alert('Incorrect admin password.');
      }
    }
  </script>
</body>
</html>
