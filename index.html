<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Couphub</title>

  <!-- Favicon (change the href to your own image link) -->
  <link rel="icon" type="image/png" href="https://cdn.discordapp.com/attachments/1306684492391383076/1410732231730663575/Couphub_Watermark.png?ex=68b21646&is=68b0c4c6&hm=c99108b8e9311e3e9279d8d546297459d896b3f936fb22141475c05ad572f35d&" />

  <!-- Load ip_log.js from GitHub (replace with your actual repository path, e.g., /your-repo/data/ip_log.js) -->
  <script src="/data/ip_log.js" defer></script>

  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: #000 url('https://media.discordapp.net/attachments/1306684492391383076/1410635744258686976/Couphub.png?ex=68b1bc69&is=68b06ae9&hm=5c21a10c3f560a98787623fcd36e87826ecb14f13549e872cadbe69eb92d2c93&=&format=webp&quality=lossless') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
      font: 16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      position: relative;
    }
    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1;
    }
    main {
      max-width: 70ch;
      position: relative;
      z-index: 2;
    }
    h1, p { margin: 0 0 1rem; }
    button {
      background: #333;
      color: #fff;
      border: none;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s;
    }
    button:hover {
      background: #555;
    }
    .hidden {
      display: none;
    }
    section {
      margin-top: 2rem;
    }
    input[type="text"], input[type="date"] {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
      margin-right: 0.5rem;
    }
    .admin-panel {
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
    }
    .ip-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .ip-table th, .ip-table td {
      padding: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-align: left;
    }
    .ip-table th {
      background: rgba(255, 255, 255, 0.1);
    }
    .filter-controls {
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <main>
    <h1>Where is Couphub?</h1>
    <p>Couphub has shut down and will not be returning anytime soon.</p> 
    <p>As good as couphub was, Every place has a time and an ending.ðŸ¦‡</p>
  </main>
  <script>
    // IP Logging
    let ipLog = [];
    
    // Load IPs from localStorage or ip_log.js
    window.addEventListener('load', () => {
      // Load from localStorage if available
      const storedIPs = localStorage.getItem('ipLog');
      if (storedIPs) {
        ipLog = JSON.parse(storedIPs);
      }
      // Load from ip_log.js if available
      if (typeof savedIPs !== 'undefined') {
        ipLog = [...new Set([...ipLog, ...savedIPs].map(entry => JSON.stringify(entry)))].map(entry => JSON.parse(entry));
        localStorage.setItem('ipLog', JSON.stringify(ipLog));
      }
      // Check if current IP is already logged in this session
      const sessionIP = sessionStorage.getItem('currentIP');
      if (!sessionIP) {
        fetch('https://ipapi.co/json/')
          .then(response => response.json())
          .then(data => {
            const newEntry = {
              ip: data.ip,
              timestamp: new Date().toLocaleString('en-GB', { timeZone: 'Europe/London' }),
              country: data.country_name || 'Unknown',
              userAgent: navigator.userAgent
            };
            // Only add if IP hasn't been logged in the last hour
            const recentLog = ipLog.find(entry => 
              entry.ip === newEntry.ip && 
              (new Date() - new Date(entry.timestamp)) < 3600000
            );
            if (!recentLog) {
              ipLog.push(newEntry);
              localStorage.setItem('ipLog', JSON.stringify(ipLog));
              sessionStorage.setItem('currentIP', data.ip);
            }
          })
          .catch(error => console.error('Error fetching IP:', error));
      }
    });

    // Secret key combination to show admin login (Ctrl + Shift + A)
    document.addEventListener('keydown', (event) => {
      if (event.ctrlKey && event.shiftKey && event.key === 'A') {
        document.getElementById('adminSection').classList.remove('hidden');
      }
    });

    function signIn() {
      const password = document.getElementById('adminPassword').value;
      const adminPassword = 'admin123'; // WARNING: Replace with a secure password and store securely
      const ipLogDiv = document.getElementById('ipLog');
      const filterControls = document.getElementById('filterControls');
      const downloadButton = document.getElementById('downloadButton');
      if (password === adminPassword) {
        ipLogDiv.classList.remove('hidden');
        filterControls.classList.remove('hidden');
        downloadButton.classList.remove('hidden');
        renderIPLog(ipLog);
      } else {
        alert('Incorrect admin password.');
        ipLogDiv.classList.add('hidden');
        filterControls.classList.add('hidden');
        downloadButton.classList.add('hidden');
      }
    }

    function renderIPLog(logs) {
      const ipLogDiv = document.getElementById('ipLog');
      if (logs.length) {
        ipLogDiv.innerHTML = `
          <h3>Logged IPs</h3>
          <table class="ip-table">
            <thead>
              <tr>
                <th>IP Address</th>
                <th>Timestamp</th>
                <th>Country</th>
                <th>User Agent</th>
              </tr>
            </thead>
            <tbody>
              ${logs.map(entry => `
                <tr>
                  <td>${entry.ip}</td>
                  <td>${entry.timestamp}</td>
                  <td>${entry.country}</td>
                  <td>${entry.userAgent}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
      } else {
        ipLogDiv.innerHTML = '<p>No IPs logged yet.</p>';
      }
    }

    function filterIPsByDate() {
      const dateFilter = document.getElementById('dateFilter').value;
      if (!dateFilter) {
        renderIPLog(ipLog);
        return;
      }
      const selectedDate = new Date(dateFilter).toLocaleDateString('en-GB');
      const filteredLogs = ipLog.filter(entry => 
        entry.timestamp.includes(selectedDate)
      );
      renderIPLog(filteredLogs);
    }

    function downloadIPLog() {
      const password = document.getElementById('adminPassword').value;
      const adminPassword = 'admin123'; // WARNING: Replace with a secure password and store securely
      if (password === adminPassword) {
        const content = `const savedIPs = ${JSON.stringify(ipLog, null, 2)};`;
        const blob = new Blob([content], { type: 'application/javascript' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'ip_log.js';
        a.click();
        URL.revokeObjectURL(url);
      } else {
        alert('Incorrect admin password.');
      }
    }

    function togglePoll() {
      const poll = document.getElementById('poll');
      poll.classList.toggle('hidden');
    }
  </script>
</body>
</html>
